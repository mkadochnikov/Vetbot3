"""
–í–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω—ã–π Telegram-–±–æ—Ç
–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –ø–æ –ª–µ—á–µ–Ω–∏—é –∫–æ—à–µ–∫
"""

import os
import logging
from telegram import Update
from telegram.ext import Application, CommandHandler, MessageHandler, filters, ContextTypes
from dotenv import load_dotenv
import requests
import json
from typing import Optional

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
load_dotenv()

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)

class VeterinaryBot:
    """–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω—ã–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç"""
    
    def __init__(self):
        # API –∫–ª—é—á–∏
        self.telegram_token = os.getenv('TELEGRAM_BOT_TOKEN')
        self.ai_key = os.getenv('DEEPSEEK_API_KEY')  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—Ç –∂–µ –∫–ª—é—á –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        
        if not self.telegram_token:
            raise ValueError("‚ùå TELEGRAM_BOT_TOKEN –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ .env —Ñ–∞–π–ª–µ")
        if not self.ai_key:
            raise ValueError("‚ùå API –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ .env —Ñ–∞–π–ª–µ")
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ AI API
        self.ai_url = "https://api.deepseek.com/v1/chat/completions"
        self.model = os.getenv('DEEPSEEK_MODEL', 'deepseek-chat')
        self.max_tokens = int(os.getenv('MAX_TOKENS', '1500'))
        self.temperature = float(os.getenv('TEMPERATURE', '0.7'))
        
        # –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä-—Ñ–µ–ª–∏–Ω–æ–ª–æ–≥
        self.system_prompt = """–¢—ã –æ–ø—ã—Ç–Ω—ã–π –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω—ã–π –≤—Ä–∞—á —Å 15-–ª–µ—Ç–Ω–∏–º —Å—Ç–∞–∂–µ–º —Ä–∞–±–æ—Ç—ã –≤ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∫–ª–∏–Ω–∏–∫–µ –¥–ª—è –∫–æ—à–µ–∫. 
–¢—ã —Ñ–µ–ª–∏–Ω–æ–ª–æ–≥ - —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –∏–º–µ–Ω–Ω–æ –ø–æ –∫–æ—à–∫–∞–º –≤—Å–µ—Ö –ø–æ—Ä–æ–¥ –∏ –≤–æ–∑—Ä–∞—Å—Ç–æ–≤.

–¢–≤–æ—è —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞:
- –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –ª–µ—á–µ–Ω–∏–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π –∫–æ—à–µ–∫
- –ó–Ω–∞–Ω–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ä–æ–¥
- –û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã —Å –∫–æ—Ç—è—Ç–∞–º–∏, –≤–∑—Ä–æ—Å–ª—ã–º–∏ –∏ –ø–æ–∂–∏–ª—ã–º–∏ –∫–æ—à–∫–∞–º–∏
- –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –∏–Ω—Ñ–µ–∫—Ü–∏–æ–Ω–Ω—ã—Ö, –ø–∞—Ä–∞–∑–∏—Ç–∞—Ä–Ω—ã—Ö –∏ —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–∏—Ö –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è—Ö –∫–æ—à–µ–∫

–¢–≤–æ–π —Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è:
- –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π, –Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã–π –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤
- –£–≤–µ—Ä–µ–Ω–Ω—ã–π –≤ –¥–∏–∞–≥–Ω–æ–∑–∞—Ö –±–ª–∞–≥–æ–¥–∞—Ä—è –±–æ–ª—å—à–æ–º—É –æ–ø—ã—Ç—É
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≤ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è—Ö –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è—Ö
- –ò—Å–ø–æ–ª—å–∑—É–µ—à—å –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω—É—é —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é —Å –ø–æ—è—Å–Ω–µ–Ω–∏—è–º–∏
- –í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–µ—à—å –¥–æ–∑–∏—Ä–æ–≤–∫–∏ –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤ –¥–ª—è –∫–æ—à–µ–∫

–ê–ª–≥–æ—Ä–∏—Ç–º –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏:
1. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—à—å —Å–∏–º–ø—Ç–æ–º—ã —Å —É—á–µ—Ç–æ–º –ø–æ—Ä–æ–¥—ã –∏ –≤–æ–∑—Ä–∞—Å—Ç–∞
2. –°—Ç–∞–≤–∏—à—å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –¥–∏–∞–≥–Ω–æ–∑ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–ø—ã—Ç–∞
3. –ù–∞–∑–Ω–∞—á–∞–µ—à—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ª–µ—á–µ–Ω–∏–µ —Å –¥–æ–∑–∏—Ä–æ–≤–∫–∞–º–∏ –¥–ª—è –∫–æ—à–µ–∫
4. –î–∞–µ—à—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –¥–æ–º–∞—à–Ω–µ–º—É —É—Ö–æ–¥—É
5. –ß–µ—Ç–∫–æ —É–∫–∞–∑—ã–≤–∞–µ—à—å –∫—Ä–∏—Ç–µ—Ä–∏–∏ –¥–ª—è —Å—Ä–æ—á–Ω–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è –≤ –∫–ª–∏–Ω–∏–∫—É

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞:
üîç **–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –¥–∏–∞–≥–Ω–æ–∑:** [–Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è]
üíä **–õ–µ—á–µ–Ω–∏–µ:** [–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç—ã —Å –¥–æ–∑–∏—Ä–æ–≤–∫–∞–º–∏ –¥–ª—è –∫–æ—à–µ–∫]
üè† **–î–æ–º–∞—à–Ω–∏–π —É—Ö–æ–¥:** [–ø–æ–¥—Ä–æ–±–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏]
‚ö†Ô∏è **–°—Ä–æ—á–Ω–æ –∫ –≤—Ä–∞—á—É –µ—Å–ª–∏:** [—Ç—Ä–µ–≤–æ–∂–Ω—ã–µ —Å–∏–º–ø—Ç–æ–º—ã]
üìã **–ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞:** [–∫–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è]

–ü–æ–º–Ω–∏: –≤–ª–∞–¥–µ–ª—å—Ü—ã –¥–æ–≤–µ—Ä—è—é—Ç —Ç–≤–æ–µ–º—É 15-–ª–µ—Ç–Ω–µ–º—É –æ–ø—ã—Ç—É —Ä–∞–±–æ—Ç—ã —Å –∫–æ—à–∫–∞–º–∏."""
        
        # –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        self.app = Application.builder().token(self.telegram_token).build()
        self._setup_handlers()
        
        logger.info("‚úÖ –í–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω—ã–π –±–æ—Ç-—Ñ–µ–ª–∏–Ω–æ–ª–æ–≥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ")
    
    def _setup_handlers(self):
        """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–æ–º–∞–Ω–¥"""
        self.app.add_handler(CommandHandler("start", self.start_command))
        self.app.add_handler(CommandHandler("help", self.help_command))
        self.app.add_handler(CommandHandler("info", self.info_command))
        self.app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, self.handle_message))
    
    def get_ai_response(self, user_message: str) -> str:
        """–ü–æ–ª—É—á–∞–µ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é"""
        headers = {
            'Authorization': f'Bearer {self.ai_key}',
            'Content-Type': 'application/json'
        }
        
        data = {
            'model': self.model,
            'messages': [
                {'role': 'system', 'content': self.system_prompt},
                {'role': 'user', 'content': f'–ü–∞—Ü–∏–µ–Ω—Ç: –∫–æ—à–∫–∞. –û–±—Ä–∞—â–µ–Ω–∏–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞: {user_message}'}
            ],
            'max_tokens': self.max_tokens,
            'temperature': self.temperature
        }
        
        try:
            response = requests.post(self.ai_url, headers=headers, json=data, timeout=30)
            
            if response.status_code == 200:
                result = response.json()
                return result['choices'][0]['message']['content']
            elif response.status_code == 402:
                logger.error("AI API: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ")
                return "üí∞ –ò–∑–≤–∏–Ω–∏—Ç–µ, —Å–µ–π—á–∞—Å —É –º–µ–Ω—è –ø—Ä–æ–±–ª–µ–º—ã —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π —Å–∏—Å—Ç–µ–º–µ. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É."
            elif response.status_code == 401:
                logger.error("AI API: –ù–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á")
                return "üîë –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π —Å–∏—Å—Ç–µ–º–µ. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É."
            else:
                logger.error(f"AI API Error: {response.status_code} - {response.text}")
                return "‚ö†Ô∏è –ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π —Å–∏—Å—Ç–µ–º–µ."
                
        except requests.exceptions.Timeout:
            logger.error("AI API: –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞")
            return "‚è∞ –ò–∑–≤–∏–Ω–∏—Ç–µ, –∞–Ω–∞–ª–∏–∑ –∑–∞–Ω—è–ª —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑."
        except requests.exceptions.ConnectionError:
            logger.error("AI API: –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è")
            return "üåê –ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç."
        except Exception as e:
            logger.error(f"AI API: –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ - {e}")
            return "‚ùå –ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."
    
    async def start_command(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–ö–æ–º–∞–Ω–¥–∞ /start"""
        welcome_message = """üê± **–í–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω—ã–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç-—Ñ–µ–ª–∏–Ω–æ–ª–æ–≥**

–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω—ã–π –≤—Ä–∞—á —Å 15-–ª–µ—Ç–Ω–∏–º –æ–ø—ã—Ç–æ–º —Ä–∞–±–æ—Ç—ã —Å –∫–æ—à–∫–∞–º–∏.
–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Å—å –Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ –∏ –ª–µ—á–µ–Ω–∏–∏ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π –∫–æ—à–µ–∫ –≤—Å–µ—Ö –ø–æ—Ä–æ–¥ –∏ –≤–æ–∑—Ä–∞—Å—Ç–æ–≤.

**–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é:**
–û–ø–∏—à–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∞—à–µ–π –∫–æ—à–∫–∏:
‚Ä¢ –û—Å–Ω–æ–≤–Ω—ã–µ —Å–∏–º–ø—Ç–æ–º—ã –∏ –∏—Ö –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
‚Ä¢ –í–æ–∑—Ä–∞—Å—Ç, –ø–æ—Ä–æ–¥–∞, –≤–µ—Å –∫–æ—à–∫–∏
‚Ä¢ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø–æ–≤–µ–¥–µ–Ω–∏–∏, –∞–ø–ø–µ—Ç–∏—Ç–µ, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
‚Ä¢ –ö–æ–≥–¥–∞ –Ω–∞—á–∞–ª–∞—Å—å –ø—Ä–æ–±–ª–µ–º–∞
‚Ä¢ –ß—Ç–æ —É–∂–µ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞–ª–∏

**–ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞—â–µ–Ω–∏—è:** 
"–ë—Ä–∏—Ç–∞–Ω—Å–∫–∞—è –∫–æ—à–∫–∞, 5 –ª–µ—Ç, 4 –∫–≥. –¢—Ä–µ—Ç–∏–π –¥–µ–Ω—å –∂–∏–¥–∫–∏–π —Å—Ç—É–ª, —Å—Ç–∞–ª–∞ –≤—è–ª–∞—è, –µ—Å—Ç –≤ –¥–≤–∞ —Ä–∞–∑–∞ –º–µ–Ω—å—à–µ –æ–±—ã—á–Ω–æ–≥–æ. –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –Ω–µ –º–µ—Ä–∏–ª–∏. –ù–∏–∫–∞–∫–∏—Ö –ª–µ–∫–∞—Ä—Å—Ç–≤ –Ω–µ –¥–∞–≤–∞–ª–∏."

–ü–æ—Å—Ç–∞–≤–ª—é –¥–∏–∞–≥–Ω–æ–∑ –∏ –Ω–∞–∑–Ω–∞—á—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ª–µ—á–µ–Ω–∏–µ! üë®‚Äç‚öïÔ∏èüêæ"""
        
        await update.message.reply_text(welcome_message, parse_mode='Markdown')
        logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {update.effective_user.id} –∑–∞–ø—É—Å—Ç–∏–ª –±–æ—Ç–∞")
    
    async def help_command(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–ö–æ–º–∞–Ω–¥–∞ /help"""
        help_text = """üÜò **–°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏**

**–ö–æ–º–∞–Ω–¥—ã:**
/start - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–æ–º
/help - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É
/info - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—Ä–∞—á–µ

**–ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø–∏—Å–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É:**

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∂–∏—Ç–µ:**
‚úÖ –í–æ–∑—Ä–∞—Å—Ç –∫–æ—à–∫–∏ (–∫–æ—Ç–µ–Ω–æ–∫/–≤–∑—Ä–æ—Å–ª–∞—è/–ø–æ–∂–∏–ª–∞—è)
‚úÖ –ü–æ—Ä–æ–¥—É –∏–ª–∏ —Ç–∏–ø (–±–µ—Å–ø–æ—Ä–æ–¥–Ω–∞—è/–±—Ä–∏—Ç–∞–Ω–µ—Ü/–º–µ–π–Ω-–∫—É–Ω –∏ —Ç.–¥.)
‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ —Å–∏–º–ø—Ç–æ–º—ã
‚úÖ –ö–∞–∫ –¥–∞–≤–Ω–æ –¥–ª–∏—Ç—Å—è –ø—Ä–æ–±–ª–µ–º–∞
‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø–æ–≤–µ–¥–µ–Ω–∏–∏

**–ü—Ä–∏–º–µ—Ä—ã —Ö–æ—Ä–æ—à–∏—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π:**
‚Ä¢ "–ü–µ—Ä—Å–∏–¥—Å–∫–∏–π –∫–æ—Ç, 3 –≥–æ–¥–∞, –∫–∞—à–ª—è–µ—Ç –Ω–µ–¥–µ–ª—é, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ 39.2, –≤—è–ª—ã–π"
‚Ä¢ "–ö–æ—Ç–µ–Ω–æ–∫ 5 –º–µ—Å—è—Ü–µ–≤, –±–µ—Å–ø–æ—Ä–æ–¥–Ω—ã–π, –ø–æ–Ω–æ—Å —Å –∫—Ä–æ–≤—å—é 2 –¥–Ω—è, –Ω–µ –∏–≥—Ä–∞–µ—Ç"
‚Ä¢ "–ú–µ–π–Ω-–∫—É–Ω, 7 –ª–µ—Ç, —Ö—Ä–æ–º–∞–µ—Ç –Ω–∞ –ª–µ–≤—É—é –∑–∞–¥–Ω—é—é –ª–∞–ø—É, –º—è—É–∫–∞–µ—Ç –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏"

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:**
‚Ä¢ –í–∞–∫—Ü–∏–Ω–∞—Ü–∏–∏ (–∫–æ–≥–¥–∞ –ø–æ—Å–ª–µ–¥–Ω—è—è)
‚Ä¢ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç –ø–∞—Ä–∞–∑–∏—Ç–æ–≤
‚Ä¢ –ß–µ–º –∫–æ—Ä–º–∏—Ç–µ
‚Ä¢ –ï—Å—Ç—å –ª–∏ –¥—Ä—É–≥–∏–µ –∂–∏–≤–æ—Ç–Ω—ã–µ

–ß–µ–º –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ - —Ç–µ–º —Ç–æ—á–Ω–µ–µ –¥–∏–∞–≥–Ω–æ–∑ –∏ –ª–µ—á–µ–Ω–∏–µ! üéØ"""
        
        await update.message.reply_text(help_text, parse_mode='Markdown')
    
    async def info_command(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–ö–æ–º–∞–Ω–¥–∞ /info"""
        info_text = """‚ÑπÔ∏è **–û –≤—Ä–∞—á–µ-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–µ**

**–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:** –§–µ–ª–∏–Ω–æ–ª–æ–≥ (–≤—Ä–∞—á –ø–æ –∫–æ—à–∫–∞–º)
**–°—Ç–∞–∂ —Ä–∞–±–æ—Ç—ã:** 15 –ª–µ—Ç –≤ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω–æ–π –ø—Ä–∞–∫—Ç–∏–∫–µ
**–û–ø—ã—Ç:** –ë–æ–ª–µ–µ 10,000 –ø—Ä–æ–ª–µ—á–µ–Ω–Ω—ã—Ö –∫–æ—à–µ–∫

**–≠–∫—Å–ø–µ—Ä—Ç–∏–∑–∞:**
üî¨ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π –∫–æ—à–µ–∫
üíä –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –ª–µ—á–µ–Ω–∏—è
üè• –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≥–æ—Å–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏
üêæ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ä–æ–¥ –∫–æ—à–µ–∫
üë∂ –†–∞–±–æ—Ç–∞ —Å –∫–æ—Ç—è—Ç–∞–º–∏ –∏ –ø–æ–∂–∏–ª—ã–º–∏ –∫–æ—à–∫–∞–º–∏

**–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è–º:**
‚Ä¢ –ò–Ω—Ñ–µ–∫—Ü–∏–æ–Ω–Ω—ã–µ –±–æ–ª–µ–∑–Ω–∏ –∫–æ—à–µ–∫
‚Ä¢ –ü–∞—Ä–∞–∑–∏—Ç–∞—Ä–Ω—ã–µ –∏–Ω–≤–∞–∑–∏–∏
‚Ä¢ –ë–æ–ª–µ–∑–Ω–∏ –ñ–ö–¢ –∏ –º–æ—á–µ–ø–æ–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
‚Ä¢ –î–µ—Ä–º–∞—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
‚Ä¢ –ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** Telegram Bot API + AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç
**–í–µ—Ä—Å–∏—è:** 2.0 (–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è)

*–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç –æ—á–Ω–æ–≥–æ –æ—Å–º–æ—Ç—Ä–∞ –ø—Ä–∏ —Å–µ—Ä—å–µ–∑–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è—Ö*"""
        
        await update.message.reply_text(info_text, parse_mode='Markdown')
    
    async def handle_message(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—Ä–∞—â–µ–Ω–∏–π –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤"""
        user_text = update.message.text
        user_id = update.effective_user.id
        
        logger.info(f"–ü–æ–ª—É—á–µ–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ –æ—Ç {user_id}: {user_text[:50]}...")
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ –≤—Ä–∞—á –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç
        status_message = await update.message.reply_text(
            "üîç –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Å–∏–º–ø—Ç–æ–º—ã –∏ —Å—Ç–∞–≤–ª—é –¥–∏–∞–≥–Ω–æ–∑... \n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ."
        )
        
        try:
            # –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é
            response = self.get_ai_response(user_text)
            
            # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–∫–ª—é—á–µ–Ω–∏–µ –≤—Ä–∞—á–∞
            await status_message.delete()
            await update.message.reply_text(response)
            logger.info(f"–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}")
                
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –¥–ª—è {user_id}: {e}")
            await status_message.edit_text(
                "üòî –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –≤–µ—Ç–∫–ª–∏–Ω–∏–∫—É."
            )
    
    def run(self):
        """–ó–∞–ø—É—Å–∫ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω–æ–≥–æ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞"""
        logger.info("üöÄ –ó–∞–ø—É—Å–∫ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω–æ–≥–æ –±–æ—Ç–∞-—Ñ–µ–ª–∏–Ω–æ–ª–æ–≥–∞...")
        try:
            self.app.run_polling(drop_pending_updates=True)
        except KeyboardInterrupt:
            logger.info("üõë –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        except Exception as e:
            logger.error(f"‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")

def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    try:
        bot = VeterinaryBot()
        bot.run()
    except Exception as e:
        print(f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞: {e}")
        print("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ .env —Ñ–∞–π–ª–µ")

if __name__ == "__main__":
    main()

