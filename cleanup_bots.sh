#!/bin/bash

# –ü—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –±–æ—Ç–æ–≤
# –í–µ—Ä—Å–∏—è: 2.1.0

echo "üßπ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –±–æ—Ç–æ–≤..."

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ enhanced_bot.py
echo "ü§ñ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ Telegram –±–æ—Ç–∞..."
pkill -f "enhanced_bot.py" 2>/dev/null && echo "‚úÖ –°—Ç–∞—Ä—ã–µ –±–æ—Ç—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã" || echo "‚ö†Ô∏è –ë–æ—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ webapp_server.py
echo "üåê –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
pkill -f "webapp_server.py" 2>/dev/null && echo "‚úÖ –°—Ç–∞—Ä—ã–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã" || echo "‚ö†Ô∏è –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ start_all.py
echo "üöÄ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ª–∞—É–Ω—á–µ—Ä–æ–≤..."
pkill -f "start_all.py" 2>/dev/null && echo "‚úÖ –°—Ç–∞—Ä—ã–µ –ª–∞—É–Ω—á–µ—Ä—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã" || echo "‚ö†Ô∏è –õ–∞—É–Ω—á–µ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ bot.py (–µ—Å–ª–∏ –µ—Å—Ç—å —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏)
echo "ü§ñ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π –±–æ—Ç–∞..."
pkill -f "bot.py" 2>/dev/null && echo "‚úÖ –°—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ –±–æ—Ç–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã" || echo "‚ö†Ô∏è –°—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"

# –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
sleep 3

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
REMAINING=$(ps aux | grep -E "(enhanced_bot|webapp_server|start_all|bot\.py)" | grep -v grep | wc -l)
if [ $REMAINING -gt 0 ]; then
    echo "‚ö†Ô∏è –ù–∞–π–¥–µ–Ω—ã –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –ø—Ä–æ—Ü–µ—Å—Å—ã, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ..."
    pkill -9 -f "enhanced_bot.py" 2>/dev/null
    pkill -9 -f "webapp_server.py" 2>/dev/null
    pkill -9 -f "start_all.py" 2>/dev/null
    pkill -9 -f "bot.py" 2>/dev/null
    sleep 2
fi

# –û—á–∏—Å—Ç–∫–∞ PID —Ñ–∞–π–ª–æ–≤
rm -f vet_services.pid 2>/dev/null

echo "‚úÖ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
FINAL_CHECK=$(ps aux | grep -E "(enhanced_bot|webapp_server|start_all|bot\.py)" | grep -v grep | wc -l)
if [ $FINAL_CHECK -eq 0 ]; then
    echo "üéâ –í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –±–æ—Ç–æ–≤ —É—Å–ø–µ—à–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!"
else
    echo "‚ö†Ô∏è –û—Å—Ç–∞–ª–∏—Å—å –ø—Ä–æ—Ü–µ—Å—Å—ã:"
    ps aux | grep -E "(enhanced_bot|webapp_server|start_all|bot\.py)" | grep -v grep
fi

